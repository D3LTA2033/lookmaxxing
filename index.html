<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Look Maxxer — Instant Rating</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#8b5cf6; --muted:#9aa4b2; --glass: rgba(255,255,255,0.04);
      --radius:14px; --fw-700:700; --fw-600:600;
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; background:linear-gradient(180deg,var(--bg),#071025 70%); color:#e6eef8; -webkit-font-smoothing:antialiased;
      display:flex; align-items:center; justify-content:center; padding:24px;
    }

    .wrapper{width:100%; max-width:980px}
    header{display:flex; align-items:center; gap:16px; margin-bottom:18px}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#06b6d4);display:flex;align-items:center;justify-content:center;font-weight:700;color:#021025}
    h1{margin:0;font-size:20px}
    p.lead{color:var(--muted); margin:4px 0 0;font-size:13px}

    .grid{display:grid; grid-template-columns: 1fr 360px; gap:20px}
    @media (max-width:880px){ .grid{grid-template-columns:1fr} }

    /* Card */
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:var(--radius); padding:18px; box-shadow:0 6px 24px rgba(4,8,18,0.6)}

    /* Left: camera / upload */
    .capture-area{display:flex; flex-direction:column; gap:12px}
    .viewer{background:var(--card); border-radius:12px; height:420px; display:flex; align-items:center; justify-content:center; overflow:hidden; position:relative}
    video, canvas.img-preview{width:100%; height:100%; object-fit:cover; display:block}
    .controls{display:flex; gap:8px; margin-top:10px}
    .btn{background:var(--glass); padding:10px 12px; border-radius:10px; border:1px solid rgba(255,255,255,0.04); cursor:pointer; color:inherit; font-weight:600}
    .btn.primary{background:linear-gradient(90deg,var(--accent),#06b6d4); color:#021025}
    input[type=file]{display:none}

    .hint{font-size:13px;color:var(--muted)}

    /* Right: results */
    .results{display:flex; flex-direction:column; gap:12px}
    .score-big{font-size:52px; font-weight:700; line-height:1}
    .meter{height:12px;background:rgba(255,255,255,0.06); border-radius:8px; overflow:hidden}
    .meter > i{display:block;height:100%; background:linear-gradient(90deg,#10b981,var(--accent)); width:0%}
    .attr-list{display:grid; grid-template-columns:1fr 1fr; gap:8px}

    .attr{background:rgba(255,255,255,0.02); padding:10px; border-radius:10px}
    .attr .name{font-size:13px;color:var(--muted)}
    .attr .val{font-weight:700}

    .tips{font-size:13px; color:var(--muted)}

    footer.small{font-size:12px;color:var(--muted); margin-top:10px}

    /* processing overlay */
    .overlay{position:absolute; inset:0; display:flex; align-items:center; justify-content:center; background:linear-gradient(180deg, rgba(2,6,23,0.5), rgba(2,6,23,0.6)); backdrop-filter: blur(4px); color: #eaf6ff; font-weight:700; font-size:14px}

    .spinner{width:40px;height:40px;border-radius:50%;border:4px solid rgba(255,255,255,0.06); border-top-color:var(--accent); animation:spin 1s linear infinite}
    @keyframes spin{to{transform:rotate(360deg)}}

    .small-muted{color:var(--muted); font-size:12px}

  </style>
</head>
<body>
  <div class="wrapper">
    <header>
      <div class="logo">LM</div>
      <div>
        <h1>Look Maxxer — Instant Rating</h1>
        <p class="lead">Take or upload a photo. Client-side analysis returns a quick score and tips — nothing is uploaded.</p>
      </div>
    </header>

    <div class="grid">
      <section class="card capture-area">
        <div class="viewer" id="viewer">
          <video id="video" autoplay playsinline style="display:none"></video>
          <canvas id="canvas" class="img-preview"></canvas>
          <div id="procOverlay" class="overlay" style="display:none">
            <div style="text-align:center">
              <div class="spinner"></div>
              <div style="margin-top:8px">Analyzing photo…</div>
            </div>
          </div>
        </div>

        <div class="controls">
          <button id="startCam" class="btn">Open Camera</button>
          <button id="snap" class="btn primary" disabled>Capture</button>
          <label class="btn" for="file">Upload</label>
          <input id="file" type="file" accept="image/*">
          <button id="retake" class="btn" style="margin-left:auto;">Retake</button>
        </div>
        <div class="hint">Tip: prefer soft natural light and a neutral background for best results.</div>
        <div class="small-muted">All processing happens in your browser — no images are sent anywhere.</div>
      </section>

      <aside class="card results">
        <div>
          <div style="display:flex; align-items:center; justify-content:space-between">
            <div>
              <div class="small-muted">Overall Score</div>
              <div class="score-big" id="score">—</div>
            </div>
            <div style="width:140px; text-align:right">
              <div class="small-muted">Confidence</div>
              <div id="confidence" style="font-weight:700">—</div>
            </div>
          </div>

          <div style="margin-top:12px">
            <div class="meter"><i id="meterFill"></i></div>
          </div>
        </div>

        <div style="margin-top:8px">
          <div class="small-muted">Attribute breakdown</div>
          <div class="attr-list" id="attrs">
            <div class="attr"><div class="name">Brightness</div><div class="val" id="brightness">—</div></div>
            <div class="attr"><div class="name">Contrast</div><div class="val" id="contrast">—</div></div>
            <div class="attr"><div class="name">Sharpness</div><div class="val" id="sharpness">—</div></div>
            <div class="attr"><div class="name">Exposure</div><div class="val" id="exposure">—</div></div>
          </div>
        </div>

        <div>
          <div style="margin-top:10px" class="small-muted">Quick tips</div>
          <div class="tips" id="tips">Take or upload a clear photo to see analysis.</div>
        </div>

        <footer class="small">Note: This demo uses simple client-side heuristics for illustration. Use a trained model for production accuracy.</footer>
      </aside>
    </div>
  </div>

  <script>
    // Elements
    const startCam = document.getElementById('startCam');
    const snap = document.getElementById('snap');
    const fileInput = document.getElementById('file');
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const procOverlay = document.getElementById('procOverlay');

    const scoreEl = document.getElementById('score');
    const confEl = document.getElementById('confidence');
    const meterFill = document.getElementById('meterFill');
    const brightnessEl = document.getElementById('brightness');
    const contrastEl = document.getElementById('contrast');
    const sharpnessEl = document.getElementById('sharpness');
    const exposureEl = document.getElementById('exposure');
    const tipsEl = document.getElementById('tips');

    let stream = null;

    function setProcessing(on){ procOverlay.style.display = on ? 'flex' : 'none'; }

    async function openCamera(){
      if (stream) return;
      try{
        stream = await navigator.mediaDevices.getUserMedia({video:{facingMode:'user', width:{ideal:1280}, height:{ideal:720}}, audio:false});
        video.srcObject = stream;
        video.style.display = 'block';
        canvas.style.display = 'none';
        snap.disabled = false;
      }catch(err){ alert('Camera access denied or not available. Use upload instead.'); }
    }

    function stopCamera(){ if(stream){ stream.getTracks().forEach(t=>t.stop()); stream=null; video.style.display='none'; } }

    startCam.addEventListener('click', async ()=>{ await openCamera(); });
    snap.addEventListener('click', ()=>{ captureFrame(); });
    document.getElementById('retake').addEventListener('click', ()=>{ resetViewer(); });

    fileInput.addEventListener('change', (e)=>{
      const f = e.target.files[0]; if (!f) return; const url = URL.createObjectURL(f); loadImage(url);
    });

    function resetViewer(){ stopCamera(); ctx.clearRect(0,0,canvas.width,canvas.height); canvas.style.display='none'; video.style.display='none'; scoreEl.textContent='—'; confEl.textContent='—'; meterFill.style.width='0%'; brightnessEl.textContent='—'; contrastEl.textContent='—'; sharpnessEl.textContent='—'; exposureEl.textContent='—'; tipsEl.textContent='Take or upload a clear photo to see analysis.' }

    function captureFrame(){
      const w = video.videoWidth || 1280, h = video.videoHeight || 720;
      canvas.width = w; canvas.height = h; ctx.drawImage(video,0,0,w,h);
      canvas.style.display='block'; video.style.display='none'; analyzeCanvas();
    }

    function loadImage(src){
      const img = new Image(); img.crossOrigin='anonymous'; img.onload = ()=>{
        const maxW = 1280; const scale = Math.min(1, maxW / img.width);
        canvas.width = img.width * scale; canvas.height = img.height * scale;
        ctx.drawImage(img,0,0,canvas.width,canvas.height);
        canvas.style.display='block'; video.style.display='none'; analyzeCanvas();
      };
      img.onerror = ()=>{ alert('Failed to load image.'); }
      img.src = src;
    }

    function analyzeCanvas(){
      try{
        setProcessing(true);
        // delay slightly so overlay shows
        setTimeout(()=>{
          const w = canvas.width, h = canvas.height;
          const imgd = ctx.getImageData(0,0,w,h);
          const data = imgd.data;
          // compute brightness (mean), contrast (stddev), sharpness (simple gradient variance), exposure bias
          let sum=0, sumSq=0;
          let gray = new Float32Array(w*h);
          for(let i=0, p=0; i<data.length; i+=4, p++){
            const r=data[i], g=data[i+1], b=data[i+2];
            const lum = (0.299*r + 0.587*g + 0.114*b);
            gray[p]=lum; sum+=lum; sumSq+=lum*lum;
          }
          const n = w*h;
          const mean = sum / n;
          const variance = (sumSq / n) - (mean*mean);
          const stddev = Math.sqrt(Math.max(0, variance));

          // sharpness: approximate via gradient magnitude variance
          let gradSum=0, gradSq=0;
          for(let y=1;y<h-1;y++){
            for(let x=1;x<w-1;x++){
              const i = y*w + x;
              const gx = gray[i+1] - gray[i-1];
              const gy = gray[i+w] - gray[i-w];
              const mag = Math.abs(gx)+Math.abs(gy);
              gradSum += mag; gradSq += mag*mag;
            }
          }
          const mcount = (w-2)*(h-2);
          const gmean = gradSum / mcount;
          const gvar = (gradSq / mcount) - (gmean*gmean);
          const gstd = Math.sqrt(Math.max(0,gvar));

          // exposure bias: distance from mid-gray (128)
          const exposureBias = Math.abs(mean - 128);

          // normalize metrics to 0..1 heuristically
          const brightnessScore = clamp((mean/255),0,1);
          const contrastScore = clamp(stddev/70,0,1); // 70 ish -> strong
          const sharpnessScore = clamp(gmean/30,0,1);
          const exposureScore = clamp(1 - (exposureBias/80),0,1);

          // overall score weighted
          const overall = Math.round( (brightnessScore*0.18 + contrastScore*0.26 + sharpnessScore*0.36 + exposureScore*0.2) * 100 );
          const confidence = Math.round( (0.6*contrastScore + 0.4*sharpnessScore) * 100 );

          // update UI
          scoreEl.textContent = overall;
          confEl.textContent = confidence + '%';
          meterFill.style.width = overall + '%';

          brightnessEl.textContent = Math.round(brightnessScore*100)+'%';
          contrastEl.textContent = Math.round(contrastScore*100)+'%';
          sharpnessEl.textContent = Math.round(sharpnessScore*100)+'%';
          exposureEl.textContent = Math.round(exposureScore*100)+'%';

          // tips
          const tips = [];
          if (brightnessScore < 0.45) tips.push('Increase lighting — face a window or add soft light.');
          if (brightnessScore > 0.85) tips.push('Lighting is strong — avoid harsh overhead lights which create shadows.');
          if (contrastScore < 0.35) tips.push('Boost contrast: clearer background separation and slightly stronger light.');
          if (sharpnessScore < 0.25) tips.push('Image is soft — use steadier shot or higher resolution.');
          if (exposureScore < 0.45) tips.push('Adjust exposure — avoid under/over-exposed photos.');
          if (tips.length===0) tips.push('Nice shot! Try minor framing/grooming tweaks for even better results.');

          tipsEl.textContent = tips.join(' ');

          setProcessing(false);
        }, 220);
      }catch(e){ setProcessing(false); alert('Analysis failed: '+e.message); }
    }

    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

    // load a pleasant demo image if available
    (function loadDemo(){
      const url = 'data:image/svg+xml;utf8,'+encodeURIComponent('<svg xmlns="http://www.w3.org/2000/svg" width="800" height="600"><rect width="100%" height="100%" fill="#132238"/><text x="50%" y="50%" fill="#9fbef0" font-size="28" font-family="Arial" dominant-baseline="middle" text-anchor="middle">Upload or Capture a Photo — Demo Placeholder</text></svg>');
      loadImage(url);
    })();

  </script>
</body>
</html>
